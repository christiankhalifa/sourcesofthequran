<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qur'an Reference Form (Password Protected, Full)</title>
<style>
:root{
  --brand:#2e7d32;
  --bg:#f3f7f4;
  --card:#ffffff;
  --muted:#666;
  --radius:12px;
}
html,body{height:100%;margin:0;}
body {
  font-family: "Segoe UI", Tahoma, Arial, sans-serif;
  background: var(--bg);
  padding: 32px;
  display:flex;
  gap:20px;
  justify-content:center;
  flex-wrap:wrap;
  box-sizing:border-box;
}

/* Lock screen */
#lock-screen{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.45);
  z-index:9999;
}
#lock-card{
  background:white;
  padding:28px;
  border-radius:14px;
  width:320px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  text-align:center;
}
#lock-card h2{margin:0 0 12px;color:var(--brand)}
#page-password{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box}
#lock-card button{margin-top:12px;background:var(--brand);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}
#error-msg{color:#d32f2f;margin-top:8px;display:none}

/* Main layout */
#main-content{
  display:flex;
  gap:20px;
  width:100%;
  max-width:1200px;
  box-sizing:border-box;
}

form {
  flex:1 1 700px;
  background:var(--card);
  padding:30px;
  border-radius:14px;
  box-shadow:0 6px 14px rgba(0,0,0,0.08);
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px 25px;
  align-items:start;
  box-sizing:border-box;
}

h2.form-title{
  grid-column:1 / -1;
  margin:0 0 18px;
  text-align:center;
  color:var(--brand);
}

label{display:block;font-weight:600;margin-bottom:6px;color:#222;font-size:14px}
input[type="text"], input[type="password"], select, textarea {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #d0d7d4;
  box-sizing:border-box;
  font-size:14px;
}
textarea{min-height:70px;resize:vertical}
button[type="submit"]{
  grid-column:1 / -1;
  padding:14px;
  background:var(--brand);
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

/* Legend box */
.legend-box{
  flex:1 1 320px;
  background:var(--card);
  border-radius:16px;
  box-shadow:0 6px 12px rgba(0,0,0,0.08);
  height:fit-content;
  position:sticky;
  top:20px;
  align-self:flex-start;
  overflow:hidden;
}
.legend-header{
  background:var(--brand);
  color:#fff;
  padding:14px 16px;
  cursor:pointer;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.legend-content{
  max-height:0;
  overflow:hidden;
  transition:max-height .4s ease;
  padding:0 16px;
  font-size:13px;
  color:#222;
}
.legend-content.open{padding:16px; max-height:70vh; overflow:auto}

/* helper hidden */
.hidden{display:none !important}

/* small screens */
@media (max-width:880px){
  form{grid-template-columns:1fr}
  #main-content{flex-direction:column;padding-bottom:60px}
  .legend-box{position:relative;top:auto}
}
</style>
</head>
<body>

<!-- LOCK SCREEN -->
<div id="lock-screen" aria-hidden="false">
  <div id="lock-card" role="dialog" aria-labelledby="lock-title">
    <h2 id="lock-title">Enter Password</h2>
    <input id="page-password" type="password" placeholder="Password" aria-label="Password">
    <div style="display:flex;gap:8px;justify-content:center">
      <button id="unlock-btn" type="button">Enter</button>
    </div>
    <p id="error-msg">Incorrect password</p>
    <p style="margin-top:10px;font-size:12px;color:#666">This is a client-side gate (not secure for sensitive data).</p>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="main-content" style="display:none;">

<form id="myForm">
  <h2 class="form-title">Qur'an Reference Form</h2>

  <!-- Full field set -->
  <div><label for="broad-topic">Broad Topic:</label><input id="broad-topic" name="broad-topic" type="text"></div>
  <div><label for="focus-point">Focus Point:</label><input id="focus-point" name="focus-point" type="text"></div>
  <div><label for="quran-ref">Qur'anic Reference(s):</label><input id="quran-ref" name="quran-ref" type="text" placeholder="e.g., 28:12"></div>
  <div><label for="quran-unit">Qur'anic Unit:</label><input id="quran-unit" name="quran-unit" type="text" placeholder="e.g., 28:7-14"></div>
  <div><label for="antecedent">Antecedent:</label><input id="antecedent" name="antecedent" type="text" placeholder="e.g., b. Sotah 12b:19-20"></div>
  <div><label for="antecedent-unit">Antecedent Unit:</label><input id="antecedent-unit" name="antecedent-unit" type="text" placeholder="e.g., b. Sotah 12b:19-22"></div>
  <div><label for="antecedent-link">Reference; Link to Antecedent:</label><input id="antecedent-link" name="antecedent-link" type="text"></div>
  <div><label for="altern-titles">Alternative Title(s) or Tradition(s):</label><input id="altern-titles" name="altern-titles" type="text" placeholder="e.g., Apocalypse of Moses; Vitae Adae et Evae"></div>
  <div><label for="broad-lit-cat">Broad Literary Category:</label>
    <select id="broad-lit-cat" name="broad-lit-cat">
      <option value=""></option>
      <option>Biblical</option>
      <option>Extra-Biblical Jewish</option>
      <option>Extra-Biblical Christian</option>
      <option>Zoroastrian</option>
      <option>Other</option>
    </select>
  </div>
  <div><label for="genre">Literary Work or Genre:</label>
    <select id="genre" name="genre">
      <option value=""></option>
      <option>Alexander Romance</option>
      <option>Apostolic Romances/Letters</option>
      <option>Ascetic / Clerical / Monastic Lit.</option>
      <option>Avesta</option>
      <option>Biblical Apocrypha & Pseudepigrapha</option>
      <option>Classical Historiography</option>
      <option>Hagiography</option>
      <option>Midrashim</option>
      <option>Mishnah</option>
      <option>New Testament</option>
      <option>Patristic Literature</option>
      <option>Piyyutim</option>
      <option>Tanakh</option>
      <option>Targumim</option>
      <option>Talmud Bavli</option>
      <option>Talmud Yerushalmi</option>
      <option>Other</option>
    </select>
  </div>
  <div><label for="misinterp">Occasion for Misinterpretation:</label><input id="misinterp" name="misinterp" type="text" placeholder="e.g., Isaiah 28:9 (quoted)"></div>
  <div><label for="embellishments">Embellishments:</label>
    <select id="embellishments" name="embellishments" multiple>
      <option disabled>— Select one or several —</option>
      <option>anachronism(s)</option>
      <option>anthropomorphism</option>
      <option>epigram(s)</option>
      <option>fables</option>
      <option>foil character(s)</option>
      <option>hyperbole</option>
      <option>mneumonic(s)</option>
      <option>parable(s)</option>
      <option>prepositions</option>
      <option>pun(s)</option>
      <option>satire</option>
      <option>symbolism</option>
      <option>taking figurative language literally</option>
    </select>
  </div>
  <div><label for="ling-dist">Linguistic Distortion:</label><input id="ling-dist" name="ling-dist" type="text"></div>
  <div><label for="eisegesis">Eisegesis:</label><input id="eisegesis" name="eisegesis" type="text"></div>
  <div><label for="orig-lang">Presumed Original Language:</label><input id="orig-lang" name="orig-lang" type="text" placeholder="e.g., Syriac (Duling, in: Charlesworth, OTP, 939)"></div>
  <div><label for="place-origin">Presumed Place of Origin:</label><input id="place-origin" name="place-origin" type="text"></div>
  <div><label for="credit-ant">Credit for Antecedent Reference:</label><input id="credit-ant" name="credit-ant" type="text" placeholder="e.g., Reynolds, The Qur’an and the Bible, 598"></div>
  <div><label for="credit-ms">Credit for MS Name:</label><input id="credit-ms" name="credit-ms" type="text" placeholder="e.g., Ben-Eliyahu, Handbook of Jewish Literature from late Antiquity, 83"></div>
  <div><label for="ms-name">MS Name:</label><input id="ms-name" name="ms-name" type="text" placeholder="e.g., London 340; MS Add. 27,169"></div>
  <div><label for="archive">Archive:</label><input id="archive" name="archive" type="text"></div>
  <div><label for="ms-lang">MS Language:</label><input id="ms-lang" name="ms-lang" type="text"></div>
  <div><label for="preserved-text">Preserved Text:</label><input id="preserved-text" name="preserved-text" type="text" placeholder="e.g., verses 10-15"></div>
  <div><label for="ref-ms">Reference to MS:</label><input id="ref-ms" name="ref-ms" type="text"></div>
  <div><label for="ms-trans">Reference to MS Transcription:</label><input id="ms-trans" name="ms-trans" type="text"></div>
  <div><label for="date-ant">Date Range for Antecedent:</label><input id="date-ant" name="date-ant" type="text"></div>
  <div><label for="date-ms">Date Range for MS:</label><input id="date-ms" name="date-ms" type="text"></div>
  <div><label for="translator">Translator:</label><input id="translator" name="translator" type="text" placeholder="e.g., Duling (eclectic)"></div>
  <div><label for="ref-translation">Reference to Translation:</label><input id="ref-translation" name="ref-translation" type="text"></div>

  <div><label for="parallel-select">Parallel Passages:</label>
    <select id="parallel-select" name="parallel">
      <option value=""></option>
      <option>Yes</option>
      <option>No</option>
    </select>
  </div>
  <div id="parallel-list-container" class="hidden">
    <label for="parallel-list">Parallel Passages (List):</label>
    <textarea id="parallel-list" name="parallel-list" placeholder="List parallel verses separated by semicolons"></textarea>
  </div>

  <div><label for="related-select">Related Passages:</label>
    <select id="related-select" name="related">
      <option value=""></option>
      <option>Yes</option>
      <option>No</option>
    </select>
  </div>
  <div id="related-list-container" class="hidden">
    <label for="related-list">Related Passages (List):</label>
    <textarea id="related-list" name="related-list" placeholder="List parallel verses separated by semicolons"></textarea>
  </div>

  <div><label for="freq-select">Frequent Formula:</label>
    <select id="freq-select" name="freq-form">
      <option value=""></option>
      <option>Yes</option>
      <option>No</option>
    </select>
  </div>
  <div id="freq-text-container" class="hidden">
    <label for="freq-text">Frequent Formula Text:</label>
    <input id="freq-text" name="freq-text" type="text" >
  </div>

  <div><label for="interpolation">Interpolation:</label><input id="interpolation" name="interpolation" type="text"></div>
  <div><label for="earliest">Earliest Antecedent:</label>
    <select id="earliest" name="earliest">
      <option value=""></option>
      <option>Yes</option>
    </select>
  </div>
  <div><label for="counter">Counter-tradition:</label><textarea id="counter" name="counter"></textarea></div>
  <div><label for="readings">Further Readings:</label><textarea id="readings" name="readings"></textarea></div>

  <button type="submit">Submit</button>
</form>

<!-- Legend -->
<div class="legend-box">
  <div class="legend-header" onclick="toggleLegend()">Field Legend <span id="legend-arrow">▼</span></div>
  <div id="legend" class="legend-content">
    <div class="legend-content" id="legend">
      <p><strong>Broad Topic: </strong>Name main protagonist (e.g. Musa), event or place this passage relates to.</p>
      <p><strong>Focus Point: </strong>Specific idea, concept or story under analysis (e.g., Refusal to Nurse).</p>
      <p><strong>Qur’anic Reference(s): </strong>Qur’anic verse(s) related to the focus point</p>
      <p><strong>Category:</strong> General classification of the antecedent source (e.g., Biblical, Jewish, Christian, or Other).</p>
      <p><strong>Antecedent:</strong> The pre-Qur’anic or earlier textual source being referenced.</p>
      <p><strong>Reference; Link to Antecedent:</strong> Bibliographic citation or URL linking to the antecedent text.</p>
      
      <p><strong>Presumed Original Language:</strong> The original language in which the antecedent text was composed (e.g., Hebrew, Aramaic, Greek, Syriac, etc.). Include author or source reference if known.</p>
      <p><strong>Presumed Place of Origin:</strong> The geographical or cultural context where the antecedent text is believed to have originated.</p>
      <p><strong>Credit for Text:</strong> Name of the individual or institution responsible for providing or transcribing the text.</p>
      <p><strong>Credit for MS Name:</strong> Attribution for the manuscript’s identification or catalog entry.</p>
      <p><strong>MS Name:</strong> The manuscript’s official title or catalog number.</p>
      <p><strong>Preserved Text (... to ...):</strong> The specific portion of text that survives or is cited (e.g., verses 10–15).</p>
      <p><strong>MS Language:</strong> The language in which the manuscript currently exists or is preserved.</p>
      <p><strong>Archive:</strong> The archive, library, or institution that holds the manuscript.</p>
      <p><strong>Reference to Manuscript:</strong> Catalog reference, shelf mark, or citation identifying the manuscript source.</p>
      <p><strong>Date Range for Production of Antecedent:</strong> The estimated time period during which the antecedent text was composed.</p>
      <p><strong>Date Range for Production of MS:</strong> The estimated period of the manuscript’s physical creation or copying.</p>
      <p><strong>Reference to MS Transcription:</strong> Citation or link to a published or digital transcription of the manuscript.</p>
      <p><strong>Translator:</strong> The name of the person responsible for translating the manuscript.</p>
      <p><strong>Reference to MS Translation:</strong> Citation or link to the translated version of the manuscript.</p>
      
      <p><strong>Frequent Formula:</strong> Indicates whether the text includes a recurring phrase or formula (e.g., “In the name of God…”).</p>
      <p><strong>Frequent Formula Text:</strong> The actual phrase identified as recurring, if “Yes” is selected above.</p>
      <p><strong>Unit (... to ...):</strong> The textual segment under analysis (e.g., verse 1–5).</p>
      <p><strong>Interpolation:</strong> Any later additions or insertions within the text; separate multiple entries with semicolons (;).</p>
      <p><strong>Parallel Passages:</strong> Indicates whether parallel or similar passages exist elsewhere in the Qur’an.</p>
      <p><strong>Parallel Passages (List):</strong> Lists the specific parallel verses or passages; separate with semicolons (;).</p>
      <p><strong>Related Passages:</strong> Indicates whether there are related or thematically connected verses.</p>
      <p><strong>Related Passages (List):</strong> Lists the related verses or thematic parallels; separate with semicolons (;).</p>
    </div>
  </div>
</div>

</div>

<script>
// Password lock screen (unchanged)
const CORRECT_PASSWORD="ChristisKing";
const unlockBtn=document.getElementById("unlock-btn");
const lockScreen=document.getElementById("lock-screen");
const mainContent=document.getElementById("main-content");
const errorMsg=document.getElementById("error-msg");

unlockBtn.addEventListener("click",()=>{
  const pw=document.getElementById("page-password").value;
  if(pw===CORRECT_PASSWORD){
    lockScreen.style.display="none";
    mainContent.style.display="flex";
    errorMsg.style.display="none";
  }else{
    errorMsg.style.display="block";
    document.getElementById("lock-card").animate([
      {transform:'translateX(0px)'},
      {transform:'translateX(-8px)'},
      {transform:'translateX(8px)'},
      {transform:'translateX(0px)'}
    ],{duration:240,easing:'ease'});
  }
});

// Conditional fields (unchanged)
const parallelSelect=document.getElementById("parallel-select");
const parallelContainer=document.getElementById("parallel-list-container");
const relatedSelect=document.getElementById("related-select");
const relatedContainer=document.getElementById("related-list-container");
const freqSelect=document.getElementById("freq-select");
const freqContainer=document.getElementById("freq-text-container");

function updateConditional(){
  parallelContainer.classList.toggle("hidden",parallelSelect.value!=="Yes");
  relatedContainer.classList.toggle("hidden",relatedSelect.value!=="Yes");
  freqContainer.classList.toggle("hidden",freqSelect.value!=="Yes");
}

parallelSelect.addEventListener("change",updateConditional);
relatedSelect.addEventListener("change",updateConditional);
freqSelect.addEventListener("change",updateConditional);
updateConditional();

// Form submission with multi-select handling
const form=document.getElementById("myForm");
const scriptURL="https://script.google.com/macros/s/AKfycbyvlkDMbS-OMkA1JzjWcEW24Nq1diYDX_itPUq5ok-N2hWp_Xv74YdO5utMK8t0vDOvsQ/exec";

form.addEventListener("submit", e => {
  e.preventDefault();

  const formData = new FormData(form);

  // Convert multi-select embellishments to a semicolon-separated string
  const embellishmentsSelect = document.getElementById("embellishments");
  const selectedOptions = Array.from(embellishmentsSelect.selectedOptions)
                               .map(opt => opt.value)
                               .filter(v => v); // remove disabled/empty
  formData.set("embellishments", selectedOptions.join("; "));

  fetch(scriptURL, { method: "POST", body: formData })
    .then(() => {
      alert("✅ Submitted successfully!");
      form.reset();
      updateConditional();
    })
    .catch(err => alert("❌ Error: " + err));
});
</script>


</body>
</html>
